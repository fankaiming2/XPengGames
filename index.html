<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä½ è¯´æˆ‘çŒœ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            padding: 25px;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        h1 {
            color: #2575fc;
            font-size: 2.2rem;
            margin-bottom: 8px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            color: #666;
            font-size: 1rem;
            font-weight: 400;
        }

        .game-section {
            display: none;
            text-align: center;
        }

        .active-section {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 25px 0;
        }

        .theme-card {
            background: white;
            border-radius: 18px;
            padding: 20px 10px;
            min-height: 120px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .theme-card:hover, .theme-card:active {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }

        .theme-card.selected {
            border-color: #2575fc;
            background-color: #f0f7ff;
        }

        .theme-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .theme-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }

        .time-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
        }

        .time-option {
            padding: 15px 25px;
            background: #f0f7ff;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: 700;
            color: #2575fc;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
            border: 2px solid transparent;
        }

        .time-option:hover, .time-option:active {
            background: #2575fc;
            color: white;
        }

        .time-option.selected {
            background: #2575fc;
            color: white;
            border-color: #1c5dc1;
            box-shadow: 0 5px 15px rgba(37, 117, 252, 0.3);
        }

        .game-area {
            margin: 30px 0;
            position: relative;
        }

        .word-card {
            background: linear-gradient(135deg, #2575fc 0%, #6a11cb 100%);
            color: white;
            padding: 40px 20px;
            border-radius: 20px;
            font-size: 2.8rem;
            font-weight: 700;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(37, 117, 252, 0.3);
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
            word-break: break-word;
        }

        .timer {
            font-size: 3.5rem;
            font-weight: 800;
            color: #294dde;
            margin: 20px 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }

        .timer-ms {
            font-size: 1.8rem;
            color: #2c48d7;
            margin-top: -10px;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .btn {
            padding: 18px 35px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-width: 160px;
        }

        .btn-primary {
            background: #2575fc;
            color: white;
            box-shadow: 0 8px 20px rgba(37, 117, 252, 0.3);
        }

        .btn-primary:hover, .btn-primary:active {
            background: #1c5dc1;
            transform: translateY(-3px);
        }

        .btn-secondary {
            background: #f1f2f6;
            color: #333;
            border: 2px solid #ddd;
        }

        .btn-secondary:hover, .btn-secondary:active {
            background: #e0e2e9;
        }

        .btn-success {
            background: #2ed573;
            color: white;
            box-shadow: 0 8px 20px rgba(46, 213, 115, 0.3);
        }

        .btn-success:hover, .btn-success:active {
            background: #25b562;
            transform: translateY(-3px);
        }

        .btn-info {
            background: #2dd1db;
            color: white;
            box-shadow: 0 8px 20px rgba(45, 209, 219, 0.3);
        }

        .btn-info:hover, .btn-info:active {
            background: #25a4ac;
            transform: translateY(-3px);
        }

        .shake-hint {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            display: flex;
            align-items: center; /* ç¡®ä¿å‚ç›´å±…ä¸­ */
            justify-content: center;
            gap: 15px; /* å¢åŠ é—´è· */
            color: #666;
            font-size: 1rem;
            border: 2px dashed #2575fc;
            min-height: 80px; /* è®¾ç½®æœ€å°é«˜åº¦ */
        }
        .shake-hint > div {
            text-align: left;
            line-height: 1.4;
        }

        .shake-hint p {
            margin: 2px 0;
        }
        /* æ¸¸æˆç•Œé¢çš„æ‰‹åŠ¿æç¤ºéƒ¨åˆ† */
        #gameSection .shake-hint {
            align-items: flex-start;
            padding: 15px;
            align-items: center; /* å‚ç›´å±…ä¸­ */
        }

        #gameSection .shake-hint .shake-icon {
            font-size: 2.2rem;
            margin-right: 15px;
        }
        .shake-icon {
            color: #2575fc;
            font-size: 2rem; /* ç¨å¾®å¢å¤§å›¾æ ‡ */
            animation: shake 2s infinite;
            flex-shrink: 0; /* é˜²æ­¢å›¾æ ‡è¢«å‹ç¼© */
        }

        @keyframes shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }

        .result-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin: 25px 0;
            text-align: center;
        }

        .score {
            font-size: 4rem;
            font-weight: 800;
            color: #2575fc;
            margin: 15px 0;
        }

        .result-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 25px 0;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ff4757;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* æ–°å¢ï¼šé‡åŠ›æ„Ÿåº”åé¦ˆæ ·å¼ */
        .gesture-feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            font-size: 4rem;
            animation: gestureFeedback 0.5s ease;
            pointer-events: none;
        }
                /* é‡åŠ›æ„Ÿåº”çŠ¶æ€æ ·å¼ */
        .motion-status {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            border: 2px dashed #ddd;
            display: flex;
            align-items: center;
            gap: 15px;
            min-height: 80px;
        }

        .motion-status.enabled {
            border-color: #2ed573;
            background: rgba(46, 213, 115, 0.1);
        }

        .motion-status.disabled {
            border-color: #ff4757;
            background: rgba(255, 71, 87, 0.1);
        }

        .motion-status i {
            font-size: 2rem;
        }

        .motion-status .status-text {
            flex: 1;
        }

        .motion-status .status-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .motion-status .status-desc {
            font-size: 0.9rem;
            color: #666;
        }

        /* æŒ‰é’®ç¦ç”¨çŠ¶æ€ */
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn:disabled:hover {
            transform: none !important;
        }

        @keyframes gestureFeedback {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            70% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }

        /* æ–°å¢ï¼šå€’è®¡æ—¶æ ·å¼ */
        .countdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .countdown-number {
            font-size: 12rem;
            font-weight: 900;
            color: white;
            text-shadow: 0 0 30px rgba(37, 117, 252, 0.8);
            margin-bottom: 20px;
            animation: countdownPulse 1s ease infinite;
        }

        .countdown-text {
            font-size: 2rem;
            color: white;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            animation: fadeInOut 1s ease infinite;
        }

        @keyframes countdownPulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        /* æ–°å¢ï¼šå‡†å¤‡ç•Œé¢æ ·å¼ */
        .ready-section {
            text-align: center;
            padding: 40px 20px;
        }

        .ready-title {
            font-size: 2.5rem;
            color: #2575fc;
            margin-bottom: 20px;
            animation: readyPulse 2s ease infinite;
        }

        .ready-hint {
            background: rgba(37, 117, 252, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0;
            border: 2px dashed #2575fc;
        }

        .ready-hint h3 {
            color: #2575fc;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .ready-hint ul {
            text-align: left;
            list-style: none;
            padding: 0;
        }

        .ready-hint li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ready-hint li i {
            color: #2575fc;
        }

        @keyframes readyPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* æ–°å¢ï¼šå›é¡¾è¯è¯­åˆ—è¡¨æ ·å¼ */
        .review-section {
            margin-top: 25px;
            text-align: left;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .review-header h3 {
            color: #2575fc;
            font-size: 1.5rem;
        }

        .review-toggle {
            background: #f0f7ff;
            border: 2px solid #2575fc;
            color: #2575fc;
            border-radius: 10px;
            padding: 8px 15px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .review-toggle:hover {
            background: #2575fc;
            color: white;
        }

        .review-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .review-content.expanded {
            max-height: 400px;
            overflow-y: auto;
        }

        .word-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            padding: 10px 5px;
        }

        .word-item {
            background: white;
            border-radius: 12px;
            padding: 15px 8px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .word-item.correct {
            background: linear-gradient(135deg, #2ed573 0%, #25b562 100%);
            color: white;
            border: 2px solid #25b562;
        }

        .word-item.skipped {
            background: linear-gradient(135deg, #ff6b81 0%, #ff4757 100%);
            color: white;
            border: 2px solid #ff4757;
        }

        .word-item .word-status {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.7rem;
            opacity: 0.9;
        }

        .word-item.correct .word-status {
            content: "âœ“";
        }

        .word-item.skipped .word-status {
            content: "â†’";
        }

        .review-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
        }

        .review-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .review-stat.correct {
            color: #2ed573;
        }

        .review-stat.skipped {
            color: #ff4757;
        }

        @media (max-width: 500px) {
            .container {
                padding: 20px;
                border-radius: 20px;
            }

            h1 {
                font-size: 1.8rem;
            }



            .word-card {
                font-size: 2.2rem;
                min-height: 160px;
                padding: 30px 15px;
            }

            .timer {
                font-size: 2.8rem;
            }

            .timer-ms {
                font-size: 1.4rem;
            }

            .countdown-number {
                font-size: 8rem;
            }

            .countdown-text {
                font-size: 1.5rem;
            }

            .ready-title {
                font-size: 2rem;
            }

            .game-controls {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 300px;
            }

            .word-list {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 10px;
            }

            .word-item {
                padding: 12px 6px;
                font-size: 1rem;
            }
        }

        .loader {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 5px solid rgba(37, 117, 252, 0.2);
            border-top: 5px solid #2575fc;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .timer-area {
            margin: 20px 0;
        }

        .timer {
            font-size: 3.5rem;
            font-weight: 800;
            color: #2575fc;
            margin: 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: baseline;
            justify-content: center;
        }

        .timer-ms {
            font-size: 1.8rem;
            font-weight: 700;
            margin-left: 2px;
        }

        /* è®¡æ—¶å™¨ç´§å¼ çŠ¶æ€æ ·å¼è°ƒæ•´ */
        .timer.timer-low {
            color: #293ed9;
            animation: pulse 1s infinite;
        }

        .timer.timer-low .timer-ms {
            color: #6c47ff;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        @keyframes rotateClockwise {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes rotateCounterclockwise {
            from { transform: rotate(0deg); }
            to { transform: rotate(-360deg); }
        }

        .rotate-clockwise {
            animation: rotateClockwise 0.5s ease;
        }

        .rotate-counterclockwise {
            animation: rotateCounterclockwise 0.5s ease;
        }
        /* æ‰‹åŠ¿æç¤ºæ ·å¼æ›´æ–° */
        .gesture-instructions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            text-align: left;
            width: 100%;
        }

        .gesture-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            color: #333;
        }

        .gesture-icon {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .correct-icon {
            color: #2ed573;
        }

        .skip-icon {
            color: #ff9f43;
        }
        #themeSection {
            padding-top: 20px; /* å¢åŠ æ•´ä¸ªsectionçš„é¡¶éƒ¨å†…è¾¹è· */
        }

        /* ä¸»é¢˜é€‰æ‹©ç•Œé¢çš„æç¤ºä¹Ÿéœ€è¦ç›¸åº”è°ƒæ•´ */
        #themeSection .shake-hint {
            align-items: flex-start;
            padding: 15px;
            align-items: center; /* å‚ç›´å±…ä¸­ */
        }
        #themeSection .shake-hint .shake-icon {
            font-size: 2.2rem;
            margin-right: 15px;
        }

        #themeSection .gesture-instructions {
            gap: 6px;
        }

        #themeSection .gesture-item {
            font-size: 0.95rem;
        }
        /* ä¿®æ”¹åŸæ¥çš„pæ ‡ç­¾æ ·å¼ */
        #resultSection .result-card > p {
            text-align: center;
            color: #666;
            font-size: 1.1rem;
            margin: 10px 0 20px 0;
            width: 100%;
        }

        /* ç¡®ä¿h2å®Œå…¨å±…ä¸­ */
        #resultSection .result-card > h2 {
            text-align: center;
            width: 100%;
            color: #2575fc;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        #requestMotionBtn {
            width: 212px; /* æˆ–ä»»æ„ä½ æƒ³è¦çš„å®½åº¦ */
            max-width: 212px; /* å¯é€‰ï¼šé™åˆ¶æœ€å¤§å®½åº¦ */
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */
            overflow: hidden; /* éšè—æº¢å‡ºå†…å®¹ */
            text-overflow: ellipsis; /* æ–‡å­—è¿‡é•¿æ˜¾ç¤ºçœç•¥å· */
            margin-top: -10px; /* å‘ä¸Šç§»åŠ¨10px */
        }


        /* ==================== æ–°å¢ï¼šåº•éƒ¨åé¦ˆå…¥å£å’Œå¼¹çª—æ ·å¼ ==================== */
        /* å…¨å±€åº•éƒ¨åé¦ˆå…¥å£ */
        .global-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 0;
            text-align: center;
            z-index: 999;
            box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.15);
            border-top: 2px solid rgba(255, 255, 255, 0.2);
        }

        .feedback-link {
            color: white;
            text-decoration: none;
            font-size: 15px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            padding: 8px 20px;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
        }

        .feedback-link:hover, .feedback-link:active {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* ä¸ºé¡µé¢å†…å®¹æ·»åŠ åº•éƒ¨å†…è¾¹è·ï¼Œé˜²æ­¢è¢«é®æŒ¡ */
        body {
            padding-bottom: 65px;
        }

        /* åé¦ˆå¼¹çª—æ ·å¼ */
        .feedback-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1001;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            margin: 20px auto;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            border-radius: 20px;
            position: relative;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close-modal {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            cursor: pointer;
            color: #666;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            background: #f0f0f0;
            color: #333;
        }

        /* å¼€å‘è€…ä¿¡æ¯ */
        .developer-info {
            display: flex;
            align-items: center;
            gap: 18px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .developer-avatar img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 3px solid #667eea;
            object-fit: cover;
        }

        .developer-message p {
            margin: 6px 0;
            line-height: 1.5;
        }

        .developer-email {
            color: #667eea;
            font-weight: 600;
            font-size: 15px;
        }

        .developer-email a {
            color: #667eea;
            text-decoration: none;
            padding: 3px 8px;
            border-radius: 6px;
            background: rgba(102, 126, 234, 0.1);
        }

        .developer-email a:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        /* å¯¹è¯åŒºåŸŸ */
        .chat-area {
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .message-bubble {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            animation: fadeIn 0.5s ease;
        }

        .message-avatar img {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid #2575fc;
            object-fit: cover;
        }

        .message-content {
            background: white;
            padding: 16px 20px;
            border-radius: 18px;
            max-width: 85%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            position: relative;
        }

        .message-content:after {
            content: '';
            position: absolute;
            left: -8px;
            top: 20px;
            width: 0;
            height: 0;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-right: 8px solid white;
        }

        .message-content p {
            margin: 0;
            color: #333;
            font-size: 15px;
            line-height: 1.5;
        }

        /* ç”¨æˆ·è¾“å…¥åŒºåŸŸ */
        .user-input-area {
            margin-top: 25px;
        }

        #userMessage {
            width: 100%;
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 15px;
            resize: vertical;
            min-height: 120px;
            margin-bottom: 20px;
            font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            transition: all 0.3s ease;
        }

        #userMessage:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        #sendEmailBtn {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        #sendEmailBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        /* æ‰“èµåŒºåŸŸ */
        .donation-section {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 2px dashed #e0e0e0;
            text-align: center;
        }

        .donation-section h4 {
            color: #ef2121;
            margin-bottom: 12px;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .donation-section p {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .qrcode-container {
            margin-top: 20px;
            display: inline-block;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid #eee;
        }

        .donation-qrcode {
            width: 200px;
            height: 200px;
            object-fit: contain;
            border-radius: 8px;
        }

        .qrcode-hint {
            color: #666;
            font-size: 13px;
            margin-top: 12px;
            font-style: italic;
        }

        /* å¼¹çª—å†…çš„è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 10px auto;
                padding: 20px 15px;
                max-height: 90vh;
            }
            
            .donation-qrcode {
                width: 180px;
                height: 180px;
            }
            
            .developer-avatar img {
                width: 60px;
                height: 60px;
            }
            
            .message-avatar img {
                width: 40px;
                height: 40px;
            }
            
            .message-content {
                max-width: 80%;
                padding: 14px 18px;
            }
            
            .global-footer {
                padding: 12px 0;
            }
            
            .feedback-link {
                font-size: 14px;
                padding: 8px 16px;
            }
            
            body {
                padding-bottom: 60px;
            }
        }

        @media (max-width: 480px) {
            .donation-qrcode {
                width: 160px;
                height: 160px;
            }
            
            .developer-info {
                flex-direction: column;
                text-align: center;
                gap: 12px;
            }
            
            .message-bubble {
                gap: 12px;
            }
        }
    </style>
</head>
<body>
<!-- å€’è®¡æ—¶è¦†ç›–å±‚ -->
<div class="countdown-overlay" id="countdownOverlay">
    <div class="countdown-number" id="countdownNumber">5</div>
    <div class="countdown-text">å‡†å¤‡å¼€å§‹</div>
</div>

<div class="container">
    <div class="header">
        <h1><i class="fas fa-gamepad"></i>ä½ è¯´æˆ‘çŒœ</h1>
    </div>
    <!-- åœ¨themeSectionçš„æ¸¸æˆæ§åˆ¶åŒºåŸŸä¸Šæ–¹æ·»åŠ  -->
    <div class="game-controls" style="margin-top: 4px;">
        <button class="btn btn-info" id="requestMotionBtn">
            <i class="fas fa-mobile-alt"></i> å¯ç”¨é‡åŠ›æ„Ÿåº”
        </button>
    </div>

    <!-- åœ¨shake-hintä¸Šæ–¹æ·»åŠ çŠ¶æ€æ˜¾ç¤º -->
    <!-- <div id="motionStatus" class="shake-hint" style="margin-top: 4px; background: #f8f9fa; display: none;">
        <i class="fas fa-check-circle" style="color: #2ed573;"></i>
        <div>
            <p style="font-weight: bold; color: #2ed573;">âœ“ é‡åŠ›æ„Ÿåº”å·²å¯ç”¨</p>
            <p style="font-size: 0.9rem;">ç°åœ¨å¯ä»¥ä½¿ç”¨æ‰‹æœºæ—‹è½¬æ¥æ§åˆ¶æ¸¸æˆ</p>
        </div>
    </div> -->
    <section id="themeSection" class="game-section active-section">
        <h2>é€‰æ‹©çŒœè¯ä¸»é¢˜</h2>
        <div class="theme-grid" id="themeGrid">
            <!-- ä¸»é¢˜å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <div class="time-options" id="timeOptions">
            <!-- æ—¶é—´é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <div class="game-controls">
            <button class="btn btn-primary" id="startGameBtn">
                <i class="fas fa-play-circle"></i>è¿›å…¥æ¸¸æˆ
            </button>
        </div>

        <div class="shake-hint">
            <i class="fas fa-mobile-alt shake-icon"></i>
            <div>
                <p>ğŸ“± æ‰‹åŠ¿æ§åˆ¶ï¼š</p>
                <p>é¡ºæ—¶é’ˆæ™ƒåŠ¨ = çŒœå¯¹</p>
                <p>é€†æ—¶é’ˆæ™ƒåŠ¨ = è·³è¿‡</p>
            </div>
        </div>
    </section>

    <!-- æ–°å¢ï¼šå‡†å¤‡ç•Œé¢ -->
    <section id="readySection" class="game-section">
        <div class="ready-section">
            <h2 class="ready-title">å‡†å¤‡å¼€å§‹!</h2>
            <p style="font-size: 1.2rem; color: #666; margin-bottom: 30px;">
                ä¸»é¢˜: <span id="readyTheme">æˆè¯­</span> Â· æ—¶é—´: <span id="readyTime">2</span>åˆ†é’Ÿ
            </p>

            <div class="ready-hint">
                <h3><i class="fas fa-lightbulb"></i> æ¸¸æˆæç¤º</h3>
                <ul>
                    <li><i class="fas fa-check-circle"></i> é¡ºæ—¶é’ˆæ—‹è½¬æ‰‹æœº = çŒœå¯¹</li>
                    <li><i class="fas fa-forward"></i> é€†æ—¶é’ˆæ—‹è½¬æ‰‹æœº = è·³è¿‡</li>
                    <li><i class="fas fa-mobile-alt"></i> ä¿æŒæ‰‹æœºç«–ç›´ä»¥è·å¾—æœ€ä½³ä½“éªŒ</li>
                    <li><i class="fas fa-bolt"></i> åŠ¨ä½œè¦å¿«é€Ÿæœæ–­ï¼Œæ—‹è½¬çº¦15åº¦å³å¯</li>
                </ul>
            </div>

            <div class="game-controls">
                <button class="btn btn-success" id="startNowBtn">
                    <i class="fas fa-rocket"></i> ç«‹å³å¼€å§‹
                </button>
                <button class="btn btn-secondary" id="cancelStartBtn">
                    <i class="fas fa-times"></i> è¿”å›
                </button>
            </div>
        </div>
    </section>

    <section id="gameSection" class="game-section">
        <div class="game-area">
            <h2 id="currentTheme" style="transform: translateY(-9px);">æˆè¯­çŒœçŒœçŒœ</h2>
            <div class="word-card" id="currentWord">
                è¯è¯­åŠ è½½ä¸­...
            </div>

            <div class="timer-area">
                <div class="timer" id="timer">
                    03:00
                    <span class="timer-ms" id="timerMs">.000</span>
                </div>
            </div>

            <div class="result-stats">
                <div class="stat-item">
                    <div class="stat-value" id="correctCount">0</div>
                    <div class="stat-label">çŒœå¯¹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="skippedCount">0</div>
                    <div class="stat-label">è·³è¿‡</div>
                </div>
            </div>
        </div>

        <div class="game-controls">
            <button class="btn btn-success" id="correctBtn">
                <i class="fas fa-check-circle"></i> çŒœå¯¹äº†
            </button>
            <button class="btn btn-secondary" id="skipBtn">
                <i class="fas fa-forward"></i> è·³è¿‡
            </button>
            <button class="btn btn-secondary" id="endGameBtn">
                <i class="fas fa-stop-circle"></i> ç»“æŸæ¸¸æˆ
            </button>
        </div>

        <div class="shake-hint">
            <i class="fas fa-mobile-alt shake-icon"></i>
            <div>
                <p>ğŸ“± æ‰‹åŠ¿æ§åˆ¶ï¼š</p>
                <p>é¡ºæ—¶é’ˆæ™ƒåŠ¨ = çŒœå¯¹</p>
                <p>é€†æ—¶é’ˆæ™ƒåŠ¨ = è·³è¿‡</p>
            </div>
        </div>
    </section>

    <section id="resultSection" class="game-section">
        <div class="result-card">
            <div class="result-header">
                <h2>æ¸¸æˆç»“æŸ!</h2>
                <p class="result-subtitle">ä½ çš„æœ€ç»ˆå¾—åˆ†</p>
            </div>
            <div class="score" id="finalScore">0</div>

            <div class="result-stats">
                <div class="stat-item">
                    <div class="stat-value" id="finalCorrect">0</div>
                    <div class="stat-label">çŒœå¯¹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="finalSkipped">0</div>
                    <div class="stat-label">è·³è¿‡</div>
                </div>
            </div>

            <p id="resultMessage">ç»§ç»­åŠ æ²¹ï¼</p>

            <!-- æ–°å¢ï¼šå›é¡¾è¯è¯­åŒºåŸŸ -->
            <div class="review-section">
                <div class="review-header">
                    <h3><i class="fas fa-history"></i> è¯è¯­å›é¡¾</h3>
                    <button class="review-toggle" id="toggleReview">
                        <i class="fas fa-chevron-down"></i> å±•å¼€æŸ¥çœ‹
                    </button>
                </div>

                <div class="review-content" id="reviewContent">
                    <div class="word-list" id="wordReviewList">
                        <!-- å›é¡¾è¯è¯­å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <div class="review-stats">
                        <div class="review-stat correct">
                            <i class="fas fa-check-circle"></i>
                            <span>çŒœå¯¹: <span id="reviewCorrectCount">0</span>ä¸ª</span>
                        </div>
                        <div class="review-stat skipped">
                            <i class="fas fa-forward"></i>
                            <span>è·³è¿‡: <span id="reviewSkippedCount">0</span>ä¸ª</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="game-controls">
            <button class="btn btn-primary" id="playAgainBtn">
                <i class="fas fa-redo"></i>å†ç©ä¸€æ¬¡
            </button>
            <!-- <button class="btn btn-info" id="showReviewBtn">
                <i class="fas fa-history"></i>æŸ¥çœ‹å›é¡¾
            </button> -->
            <button class="btn btn-secondary" id="backToThemeBtn">
                <i class="fas fa-palette"></i>é€‰æ‹©å…¶ä»–ä¸»é¢˜
            </button>
        </div>
    </section>

    <div class="loader" id="loader">
        <div class="spinner"></div>
        <p>æ¸¸æˆåŠ è½½ä¸­...</p>
    </div>
</div>
<!-- ==================== æ–°å¢ï¼šå…¨å±€åº•éƒ¨åé¦ˆå…¥å£ ==================== -->
<div id="globalFooter" class="global-footer">
    <div class="footer-content">
        <a href="#" id="feedbackTrigger" class="feedback-link">
            <i class="fas fa-comment-alt"></i> æ”¯æŒå¼€å‘è€… / åé¦ˆBUG
        </a>
    </div>
</div>

<!-- ==================== æ–°å¢ï¼šåé¦ˆå¼¹çª— ==================== -->
<div id="feedbackModal" class="feedback-modal">
    <div class="modal-content">
        <!-- å…³é—­æŒ‰é’® -->
        <span class="close-modal">&times;</span>
        
        <!-- å¼€å‘è€…ä¿¡æ¯ -->
        <div class="developer-info">
           
            <div class="developer-message" style="margin-left: 15px; padding-left: 0;">
                <h1><i class="fas fa-gamepad"></i>ä½ è¯´æˆ‘çŒœ</h1>
            </div>
        </div>
        
        <!-- å¯¹è¯åŒºåŸŸ -->
        <div class="chat-area">
            
            <div class="message-bubble">
                <div class="message-avatar">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=youngboy" alt="å¼€å‘è€…å¤´åƒ">
                </div>
                <div class="message-content">
                    <p>æ‚¨å¥½ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°æ‚¨å‘¢~</p>
                </div>
            </div>
            
            <!-- ç©å®¶è¾“å…¥åŒºåŸŸ -->
            <div class="user-input-area">
                <textarea 
                    id="userMessage" 
                    placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜/å»ºè®®ï¼ˆå¦‚ï¼šæˆ‘æƒ³æ–°å¢ä¸€ä¸ªâ€œè”¬èœæ°´æœâ€ä¸»é¢˜çš„è¯åº“ï¼Œå·²å‘ç±³æ”¯æŒï¼Œè°¢è°¢~ï¼‰"
                    rows="4"
                ></textarea>
                <button id="sendEmailBtn" class="btn btn-primary"  style="float: right; width: auto; padding: 16px 30px;">
                    <i class="fas fa-paper-plane"></i> å‘é€
                </button>
                <div style="clear: both;"></div> <!-- æ¸…é™¤æµ®åŠ¨ -->
            </div>
        </div>
        
        <!-- ç‚¹èµæ”¯æŒåŒºåŸŸ -->
        <div class="donation-section">
            <h4><i class="fas fa-hand-holding-usd"></i> æ”¯æŒå¼€å‘è€…</h4>
            <div class="qrcode-container">
                <div class="image-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px;">
                    <!-- ç¬¬1å¼ å›¾ç‰‡ï¼ˆå·¦ä¸Šï¼‰ -->
                    <div class="image-item" style="aspect-ratio: 1; overflow: hidden; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: all 0.3s ease; cursor: pointer; position: relative;">
                        <img src="https://raw.githubusercontent.com/fankaiming2/XPengGames/main/image/IMG_1391.JPG"
                             alt="æ¸¸æˆæˆªå›¾1"
                             style="width: 100%; height: 100%; object-fit: cover;"
                             onclick="showImageModal('main/image/IMG_1391.JPG', 'æ¸¸æˆæˆªå›¾1')">
                        <div class="image-hover" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.3s ease; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-search-plus" style="color: white; font-size: 20px;"></i>
                        </div>
                    </div>

                    <!-- ç¬¬2å¼ å›¾ç‰‡ï¼ˆå³ä¸Šï¼‰ -->
                    <div class="image-item" style="aspect-ratio: 1; overflow: hidden; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: all 0.3s ease; cursor: pointer; position: relative;">
                        <img src="https://raw.githubusercontent.com/fankaiming2/XPengGames/main/image/IMG_1392.JPG"
                             alt="æ¸¸æˆæˆªå›¾2"
                             style="width: 100%; height: 100%; object-fit: cover;"
                             onclick="showImageModal('main/image/IMG_1392.JPG', 'æ¸¸æˆæˆªå›¾2')">
                        <div class="image-hover" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.3s ease; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-search-plus" style="color: white; font-size: 20px;"></i>
                        </div>
                    </div>

                    <!-- ç¬¬3å¼ å›¾ç‰‡ï¼ˆå·¦ä¸‹ï¼‰ -->
                    <div class="image-item" style="aspect-ratio: 1; overflow: hidden; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: all 0.3s ease; cursor: pointer; position: relative;">
                        <img src="https://raw.githubusercontent.com/fankaiming2/XPengGames/main/image/IMG_1393.JPG"
                             alt="æ¸¸æˆæˆªå›¾3"
                             style="width: 100%; height: 100%; object-fit: cover;"
                             onclick="showImageModal('main/image/IMG_1393.JPG', 'æ¸¸æˆæˆªå›¾3')">
                        <div class="image-hover" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.3s ease; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-search-plus" style="color: white; font-size: 20px;"></i>
                        </div>
                    </div>

                    <!-- ç¬¬4å¼ å›¾ç‰‡ï¼ˆå³ä¸‹ï¼‰ -->
                    <div class="image-item" style="aspect-ratio: 1; overflow: hidden; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: all 0.3s ease; cursor: pointer; position: relative;">
                        <img src="https://raw.githubusercontent.com/fankaiming2/XPengGames/main/image/IMG_1394.JPG"
                             alt="æ¸¸æˆæˆªå›¾4"
                             style="width: 100%; height: 100%; object-fit: cover;"
                             onclick="showImageModal('main/image/IMG_1394.JPG', 'æ¸¸æˆæˆªå›¾4')">
                        <div class="image-hover" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.3s ease; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-search-plus" style="color: white; font-size: 20px;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- å¼€å‘è€…ä¿¡æ¯ -->
        <div class="developer-info">
    
            <div class="developer-message" style="margin-left: 15px; padding-left: 0; margin-top: 15px;">
                <p class="developer-email">è”ç³»é‚®ç®±ï¼š<a href="mailto:ming95ming@126.com">ming95ming@126.com</a></p>
            </div>
        </div>
    </div>
</div>
<script>
            // ==================== æ–°å¢ï¼šé‡åŠ›æ„Ÿåº”çŠ¶æ€ç®¡ç† ====================
        const motionState = {
            hasPermission: false,
            isSupported: 'DeviceOrientationEvent' in window,
            isIos: /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream
        };

        // è¯·æ±‚é‡åŠ›æ„Ÿåº”æƒé™
        function requestMotionPermission() {
            if (!motionState.isSupported) {
                if (typeof callback === 'function') callback(false);
                return;
            }

            if (motionState.isIos) {
                // iOSéœ€è¦ç‰¹æ®Šæƒé™è¯·æ±‚
                if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                    DeviceOrientationEvent.requestPermission()
                        .then(permissionState => {
                            if (permissionState === 'granted') {
                                motionState.hasPermission = true;
                                showMotionStatus(true);
                                startGestureListening();
                                console.log('iOSé‡åŠ›æ„Ÿåº”æƒé™å·²æˆäºˆ');
                            } else {
                                showMotionStatus(false, 'æƒé™è¢«æ‹’ç»');
                            }
                        })
                        .catch(error => {
                            console.error('è¯·æ±‚æƒé™å¤±è´¥:', error);
                            showMotionStatus(false, 'è¯·æ±‚å¤±è´¥');
                        });
                } else {
                    // iOS 13+ ä¹‹å‰ç‰ˆæœ¬
                    motionState.hasPermission = true;
                    startGestureListening();
                    showMotionStatus(true);
                }
            } else {
                // Androidå’Œå…¶ä»–è®¾å¤‡é€šå¸¸ä¸éœ€è¦ç‰¹æ®Šæƒé™
                motionState.hasPermission = true;
                startGestureListening();
                showMotionStatus(true);
            }
        }

        // æ˜¾ç¤ºé‡åŠ›æ„Ÿåº”çŠ¶æ€
        function showMotionStatus(enabled, message = '') {
            const statusElement = document.getElementById('motionStatus');
            const requestBtn = document.getElementById('requestMotionBtn');

            if (enabled) {
                // statusElement.style.display = 'flex';
                // statusElement.innerHTML = `
                //     <i class="fas fa-check-circle" style="color: #2ed573; font-size: 1.5rem;"></i>
                //     // <div>
                //     //     <p style="font-weight: bold; color: #2ed573; margin: 0;">âœ“ é‡åŠ›æ„Ÿåº”å·²å¯ç”¨</p>
                //     //     <p style="font-size: 0.9rem; margin: 5px 0 0 0; color: #666;">ç°åœ¨å¯ä»¥ä½¿ç”¨æ‰‹æœºæ—‹è½¬æ§åˆ¶æ¸¸æˆ</p>
                //     // </div>
                // `;
                requestBtn.innerHTML = '<i class="fas fa-check-circle"></i> é‡åŠ›æ„Ÿåº”å·²å¯ç”¨';
                requestBtn.classList.remove('btn-info');
                requestBtn.classList.add('btn-success');
            } else {
                statusElement.style.display = 'flex';
                statusElement.innerHTML = `
                    <i class="fas fa-exclamation-circle" style="color: #ff4757; font-size: 1.5rem;"></i>
                    <div>
                        <p style="font-weight: bold; color: #ff4757; margin: 0;">âœ— é‡åŠ›æ„Ÿåº”æœªå¯ç”¨</p>
                        <p style="font-size: 0.9rem; margin: 5px 0 0 0; color: #666;">${message || 'è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¯ç”¨'}</p>
                    </div>
                `;
                requestBtn.innerHTML = '<i class="fas fa-mobile-alt"></i> å¯ç”¨é‡åŠ›æ„Ÿåº”';
                requestBtn.classList.remove('btn-success');
                requestBtn.classList.add('btn-info');
            }
        }
    // ==================== é…ç½®åŒºåŸŸ ====================
    const CONFIG = {
        // ä¸»é¢˜é…ç½®æ–‡ä»¶æ˜ å°„ï¼ˆæ–‡ä»¶å -> æ˜¾ç¤ºåç§°ï¼‰
        themeFiles: {
            'idiom.txt': 'æˆè¯­',
            'star.txt': 'æ˜æ˜Ÿ',
            'food.txt': 'ç¾é£Ÿ',
            'sport.txt': 'è¿åŠ¨',
            'movie.txt': 'ç”µå½±',
            'animal.txt': 'åŠ¨ç‰©'
        },

        // ä¸»é¢˜å›¾æ ‡æ˜ å°„
        themeIcons: {
            'æˆè¯­': 'fas fa-book-open',
            'æ˜æ˜Ÿ': 'fas fa-star',
            'ç¾é£Ÿ': 'fas fa-utensils',
            'è¿åŠ¨': 'fas fa-running',
            'ç”µå½±': 'fas fa-film',
            'åŠ¨ç‰©': 'fas fa-paw'
        },

        // ä¸»é¢˜é¢œè‰²æ˜ å°„
        themeColors: {
            'æˆè¯­': '#2575fc',
            'æ˜æ˜Ÿ': '#ff9f43',
            'ç¾é£Ÿ': '#ee5a24',
            'è¿åŠ¨': '#2ed573',
            'ç”µå½±': '#6c5ce7',
            'åŠ¨ç‰©': '#00d2d3'
        },

        // é‡åŠ›æ„Ÿåº”é…ç½® - ä¿®æ”¹ä¸ºæ—‹è½¬æ£€æµ‹
        GESTURE: {
            MIN_ROTATION_ANGLE: 15,      // æœ€å°æ—‹è½¬è§’åº¦ï¼ˆåº¦ï¼‰- æ›´çµæ•
            MAX_ROTATION_ANGLE: 90,       // æœ€å¤§æ—‹è½¬è§’åº¦ï¼ˆåº¦ï¼‰- é¿å…è¿‡åº¦æ—‹è½¬
            ROTATION_SPEED_THRESHOLD: 45, // æœ€å°æ—‹è½¬é€Ÿåº¦ï¼ˆåº¦/ç§’ï¼‰- é™ä½è¦æ±‚
            COOLDOWN: 600,                // æ‰‹åŠ¿å†·å´æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰- ç¼©çŸ­
            DEBOUNCE_TIME: 200,           // é˜²æŠ–æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
            HISTORY_SIZE: 8               // å†å²è®°å½•å¤§å°
        },
        // æ—¶é—´é€‰é¡¹
        timeOptions: [1, 2, 3]
    };

    // ==================== æ¸¸æˆçŠ¶æ€ ====================
    const gameState = {
        themes: [],              // ä»æ–‡ä»¶åŠ è½½çš„ä¸»é¢˜æ•°æ®
        currentTheme: null,
        selectedTime: 2,
        timer: null,
        timeLeft: 0,            // æ€»ç§’æ•°
        timeLeftMs: 0,          // æ¯«ç§’éƒ¨åˆ†
        currentWordIndex: 0,
        correctCount: 0,
        skippedCount: 0,
        totalWordsShown: 0,
        wordsForGame: [],
        lastGestureTime: 0,     // ä¸Šæ¬¡æ‰‹åŠ¿æ—¶é—´æˆ³
        lastAcceleration: { x: 0, y: 0, z: 0 }, // ä¸Šæ¬¡åŠ é€Ÿåº¦å€¼
        // æ–°å¢ï¼šè®°å½•æ¯ä¸ªè¯è¯­çš„çŠ¶æ€
        wordHistory: [], // æ ¼å¼: { word: "è¯è¯­", status: "correct"|"skipped", timestamp: æ—¶é—´æˆ³ }
        // æ–°å¢ï¼šå€’è®¡æ—¶ç›¸å…³
        countdownTimer: null,
        countdownValue: 5,
        // æ–°å¢ï¼šé‡åŠ›æ„Ÿåº”æ§åˆ¶æ ‡å¿—
        motionEnabled: false,   // æ¸¸æˆè¿‡ç¨‹ä¸­æ‰å¯ç”¨é‡åŠ›æ„Ÿåº”
        motionListener: null    // ä¿å­˜äº‹ä»¶ç›‘å¬å™¨å¼•ç”¨ï¼Œä¾¿äºç§»é™¤
    };

    // ==================== DOMå…ƒç´  ====================
    const elements = {
        themeGrid: document.getElementById('themeGrid'),
        timeOptions: document.getElementById('timeOptions'),
        currentTheme: document.getElementById('currentTheme'),
        currentWord: document.getElementById('currentWord'),
        timer: document.getElementById('timer'),
        timerMs: document.getElementById('timerMs'),
        correctCount: document.getElementById('correctCount'),
        skippedCount: document.getElementById('skippedCount'),
        finalScore: document.getElementById('finalScore'),
        finalCorrect: document.getElementById('finalCorrect'),
        finalSkipped: document.getElementById('finalSkipped'),
        resultMessage: document.getElementById('resultMessage'),
        loader: document.getElementById('loader'),
        // æ–°å¢ï¼šå›é¡¾ç›¸å…³å…ƒç´ 
        reviewContent: document.getElementById('reviewContent'),
        wordReviewList: document.getElementById('wordReviewList'),
        reviewCorrectCount: document.getElementById('reviewCorrectCount'),
        reviewSkippedCount: document.getElementById('reviewSkippedCount'),
        toggleReview: document.getElementById('toggleReview'),
        // showReviewBtn: document.getElementById('showReviewBtn'),
        // æ–°å¢ï¼šå€’è®¡æ—¶å…ƒç´ 
        countdownOverlay: document.getElementById('countdownOverlay'),
        countdownNumber: document.getElementById('countdownNumber'),
        // æ–°å¢ï¼šå‡†å¤‡ç•Œé¢å…ƒç´ 
        readySection: document.getElementById('readySection'),
        readyTheme: document.getElementById('readyTheme'),
        readyTime: document.getElementById('readyTime'),
        startNowBtn: document.getElementById('startNowBtn'),
        cancelStartBtn: document.getElementById('cancelStartBtn')
    };

    // ==================== æ ¸å¿ƒåŠŸèƒ½ ====================

    // 1. ä»TXTæ–‡ä»¶åŠ è½½è¯è¯­åº“
    async function loadWordFile(filename) {
        try {
            const response = await fetch(`words/${filename}`);
            if (!response.ok) throw new Error(`æ— æ³•åŠ è½½æ–‡ä»¶: ${filename}`);

            const text = await response.text();
            const words = text.split('\n')
                .map(line => line.trim())
                .filter(line => line && !line.startsWith('#') && !line.startsWith('//'));

            console.log(`åŠ è½½ä¸»é¢˜ ${filename}: ${words.length} ä¸ªè¯è¯­`);
            return words;
        } catch (error) {
            console.error('åŠ è½½è¯è¯­æ–‡ä»¶å¤±è´¥:', error);
            return getDefaultWords(filename);
        }
    }

    // 2. åˆå§‹åŒ–æ‰€æœ‰ä¸»é¢˜
    async function initAllThemes() {
        showLoader(true);
        gameState.themes = [];

        for (const [filename, themeName] of Object.entries(CONFIG.themeFiles)) {
            const words = await loadWordFile(filename);
            if (words.length > 0) {
                gameState.themes.push({
                    id: filename.replace('.txt', ''),
                    name: themeName,
                    icon: CONFIG.themeIcons[themeName] || 'fas fa-question-circle',
                    color: CONFIG.themeColors[themeName] || '#888',
                    words: words
                });
            }
        }

        // å¦‚æœæ²¡åŠ è½½åˆ°ä»»ä½•ä¸»é¢˜ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®
        if (gameState.themes.length === 0) {
            console.log('ä½¿ç”¨é»˜è®¤ä¸»é¢˜æ•°æ®');
            gameState.themes = getDefaultThemes();
        }

        initThemeSelection();
        showLoader(false);
        console.log(`æˆåŠŸåŠ è½½ ${gameState.themes.length} ä¸ªä¸»é¢˜`);
    }

    // 3. åˆå§‹åŒ–ä¸»é¢˜é€‰æ‹©ç•Œé¢
    function initThemeSelection() {
        elements.themeGrid.innerHTML = '';
        gameState.themes.forEach(theme => {
            const themeCard = document.createElement('div');
            themeCard.className = 'theme-card';
            themeCard.dataset.id = theme.id;
            themeCard.innerHTML = `
                <i class="${theme.icon} theme-icon" style="color:${theme.color}"></i>
                <div class="theme-name">${theme.name}</div>
            `;
            themeCard.addEventListener('click', () => selectTheme(theme.id));
            elements.themeGrid.appendChild(themeCard);
        });

        // åˆå§‹åŒ–æ—¶é—´é€‰é¡¹
        initTimeOptions();

        // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªä¸»é¢˜
        if (gameState.themes.length > 0) {
            selectTheme(gameState.themes[0].id);
        }
    }

    function initTimeOptions() {
        elements.timeOptions.innerHTML = '';
        CONFIG.timeOptions.forEach(time => {
            const timeOption = document.createElement('div');
            timeOption.className = `time-option ${time === 2 ? 'selected' : ''}`;
            timeOption.textContent = `${time}åˆ†é’Ÿ`;
            timeOption.dataset.time = time;
            timeOption.addEventListener('click', () => selectTime(time));
            elements.timeOptions.appendChild(timeOption);
        });
    }

    function selectTheme(themeId) {
        document.querySelectorAll('.theme-card').forEach(card => {
            card.classList.remove('selected');
        });

        const selectedCard = document.querySelector(`.theme-card[data-id="${themeId}"]`);
        if (selectedCard) selectedCard.classList.add('selected');

        gameState.currentTheme = gameState.themes.find(t => t.id === themeId);
    }

    function selectTime(time) {
        document.querySelectorAll('.time-option').forEach(option => {
            option.classList.remove('selected');
        });

        const selectedOption = document.querySelector(`.time-option[data-time="${time}"]`);
        if (selectedOption) selectedOption.classList.add('selected');

        gameState.selectedTime = time;
    }

    // 4. å¼€å§‹æ¸¸æˆ - ä¿®æ”¹ä¸ºè¿›å…¥å‡†å¤‡ç•Œé¢
    function startGame() {
        if (!gameState.currentTheme) {
            alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä¸»é¢˜ï¼');
            return;
        }
        // è‡ªåŠ¨è¯·æ±‚é‡åŠ›æ„Ÿåº”æƒé™ï¼ˆå¦‚æœæœªå¯ç”¨ï¼‰
        if (!motionState.hasPermission && motionState.isSupported) {
            console.log('è‡ªåŠ¨è¯·æ±‚é‡åŠ›æ„Ÿåº”æƒé™...');
            requestMotionPermission();
        }

        // æ›´æ–°å‡†å¤‡ç•Œé¢ä¿¡æ¯
        elements.readyTheme.textContent = gameState.currentTheme.name;
        elements.readyTime.textContent = gameState.selectedTime;

        // æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
        window.scrollTo({ top: 0, behavior: 'smooth' });

        // æ˜¾ç¤ºå‡†å¤‡ç•Œé¢
        showSection('ready');
    }

    // 5. ç«‹å³å¼€å§‹æ¸¸æˆï¼ˆä»å‡†å¤‡ç•Œé¢ï¼‰
        // ä¿®æ”¹åçš„ startGameNow å‡½æ•°ï¼ˆä»å‡†å¤‡ç•Œé¢å¼€å§‹ï¼‰
    function startGameNow() {
        // æ£€æŸ¥é‡åŠ›æ„Ÿåº”çŠ¶æ€ï¼Œä½†ä¸å†å¼¹å‡ºç¡®è®¤æ¡†
        if (!motionState.hasPermission && motionState.isSupported) {
            console.log('é‡åŠ›æ„Ÿåº”æœªå¯ç”¨ï¼Œå°†ä»…ä½¿ç”¨æŒ‰é’®æ“ä½œ');
        }

        // é‡ç½®æ¸¸æˆçŠ¶æ€
        resetGameState();
        // ç¡®ä¿é‡åŠ›æ„Ÿåº”æ˜¯ç¦ç”¨çŠ¶æ€ï¼ˆå€’è®¡æ—¶æœŸé—´ï¼‰
        disableGameMotion();

        // å‡†å¤‡è¯è¯­
        gameState.wordsForGame = [...gameState.currentTheme.words];
        shuffleArray(gameState.wordsForGame);

        // æ›´æ–°UI
        elements.currentTheme.textContent = gameState.currentTheme.name + 'çŒœçŒœçŒœ';

        // å¼€å§‹å€’è®¡æ—¶
        startCountdown();
    }

    // 6. å¼€å§‹å€’è®¡æ—¶
    function startCountdown() {
        // ç¡®ä¿é‡åŠ›æ„Ÿåº”æ˜¯ç¦ç”¨çŠ¶æ€
        disableGameMotion();
        // é‡ç½®å€’è®¡æ—¶å€¼
        gameState.countdownValue = 5;
        elements.countdownNumber.textContent = gameState.countdownValue;
        elements.countdownOverlay.style.display = 'flex';

        gameState.countdownTimer = setInterval(() => {
            gameState.countdownValue--;

            if (gameState.countdownValue > 0) {
                elements.countdownNumber.textContent = gameState.countdownValue;

                // æ·»åŠ éœ‡åŠ¨åé¦ˆï¼ˆå¦‚æœæ”¯æŒï¼‰
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
            } else {
                // å€’è®¡æ—¶ç»“æŸæ—¶ç›´æ¥éšè—è¦†ç›–å±‚å¹¶å¼€å§‹æ¸¸æˆ
                clearInterval(gameState.countdownTimer);
                elements.countdownOverlay.style.display = 'none';

                // ç›´æ¥å¼€å§‹æ¸¸æˆï¼Œæ²¡æœ‰é¢å¤–å»¶è¿Ÿ
                startActualGame();
            }
        }, 1000);
    }

    // 7. å®é™…å¼€å§‹æ¸¸æˆé€»è¾‘
    function startActualGame() {
        // æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
        window.scrollTo({ top: 0, behavior: 'smooth' });

        // æ˜¾ç¤ºæ¸¸æˆç•Œé¢
        showSection('game');
        // å†æ¬¡æ£€æŸ¥é‡åŠ›æ„Ÿåº”çŠ¶æ€
        if (!motionState.hasPermission && motionState.isSupported) {
            console.log('æ¸¸æˆå¼€å§‹ï¼Œä½†é‡åŠ›æ„Ÿåº”æœªå¯ç”¨ï¼Œä»…ä½¿ç”¨æŒ‰é’®æ“ä½œ');
        }

        // å¼€å§‹è®¡æ—¶å™¨
        startTimer();

        // æ˜¾ç¤ºç¬¬ä¸€ä¸ªè¯è¯­
        showNextWord();

        // åˆå§‹åŒ–æ‰‹åŠ¿æ£€æµ‹
        initGestureDetection();
        enableGameMotion(); // æ–°å¢ï¼šå¯ç”¨æ¸¸æˆè¿‡ç¨‹ä¸­çš„é‡åŠ›æ„Ÿåº”

    }

    // 8. é‡ç½®æ¸¸æˆçŠ¶æ€
    function resetGameState() {
        gameState.currentWordIndex = 0;
        gameState.correctCount = 0;
        gameState.skippedCount = 0;
        gameState.totalWordsShown = 0;
        gameState.timeLeft = gameState.selectedTime * 60;
        gameState.timeLeftMs = 0;
        gameState.wordHistory = []; // æ¸…ç©ºå†å²è®°å½•
        gameState.lastGestureTime = 0; // é‡ç½®æ‰‹åŠ¿æ—¶é—´
        gameState.motionEnabled = false; // æ–°å¢ï¼šé‡ç½®ä¸ºç¦ç”¨çŠ¶æ€


        // é‡ç½®UI
        elements.correctCount.textContent = '0';
        elements.skippedCount.textContent = '0';
        elements.timer.classList.remove('timer-low');

        resetBaselineAngle(); // é‡ç½®åŸºå‡†è§’åº¦
    }

    // ä¿®æ”¹è®¡æ—¶å™¨HTMLç»“æ„
    function startTimer() {
        clearInterval(gameState.timer);

        // è®¾ç½®åˆå§‹æ˜¾ç¤º
        const minutes = Math.floor(gameState.timeLeft / 60);
        const seconds = gameState.timeLeft % 60;
        const timerText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        elements.timer.innerHTML = `${timerText}<span class="timer-ms" id="timerMs">.000</span>`;

        const startTime = Date.now();
        const totalMs = gameState.timeLeft * 1000;

        gameState.timer = setInterval(() => {
            const elapsed = Date.now() - startTime;
            const remaining = Math.max(0, totalMs - elapsed);

            gameState.timeLeft = Math.floor(remaining / 1000);
            gameState.timeLeftMs = remaining % 1000;

            updateTimerDisplay();

            if (remaining <= 0) {
                endGame();
            }
        }, 16);
    }

    // ä¿®æ”¹updateTimerDisplayå‡½æ•°
    function updateTimerDisplay() {
        const minutes = Math.floor(gameState.timeLeft / 60);
        const seconds = gameState.timeLeft % 60;

        // æ›´æ–°ä¸»è®¡æ—¶å™¨
        const timerText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        elements.timer.innerHTML = `${timerText}<span class="timer-ms" id="timerMs">.${gameState.timeLeftMs.toString().padStart(3, '0')}</span>`;

        // ä½æ—¶é—´æé†’
        if (gameState.timeLeft < 10) {
            elements.timer.classList.add('timer-low');
        } else {
            elements.timer.classList.remove('timer-low');
        }
    }

    // 9. æ¸¸æˆæ§åˆ¶åŠŸèƒ½
    function showNextWord() {
        if (gameState.currentWordIndex >= gameState.wordsForGame.length) {
            shuffleArray(gameState.wordsForGame);
            gameState.currentWordIndex = 0;
        }

        const word = gameState.wordsForGame[gameState.currentWordIndex];
        elements.currentWord.textContent = word;
        gameState.totalWordsShown++;
        updateGameStats();
        gameState.currentWordIndex++;
    }

    function updateGameStats() {
        elements.correctCount.textContent = gameState.correctCount;
        elements.skippedCount.textContent = gameState.skippedCount;
    }

    // 10. å¢å¼ºmarkCorrectå’ŒskipWordçš„åé¦ˆ - ä¿®æ”¹ä¸ºè®°å½•å†å²
    function markCorrect() {
        const currentWord = elements.currentWord.textContent;
        // è®°å½•åˆ°å†å²
        gameState.wordHistory.push({
            word: currentWord,
            status: 'correct',
            timestamp: Date.now()
        });

        gameState.correctCount++;
        showNextWord();

        // æ·»åŠ é¢å¤–åé¦ˆ
        elements.currentWord.style.animation = 'none';
        setTimeout(() => {
            elements.currentWord.style.animation = 'pulse 0.5s ease';
        }, 10);
    }

    function skipWord() {
        const currentWord = elements.currentWord.textContent;
        // è®°å½•åˆ°å†å²
        gameState.wordHistory.push({
            word: currentWord,
            status: 'skipped',
            timestamp: Date.now()
        });

        gameState.skippedCount++;
        showNextWord();

        // æ·»åŠ é¢å¤–åé¦ˆ
        elements.currentWord.style.animation = 'none';
        setTimeout(() => {
            elements.currentWord.style.animation = 'shake 0.5s ease';
        }, 10);
    }

    // 11. æ¸¸æˆç»“æŸ - ä¿®æ”¹ä¸ºåŒ…å«å›é¡¾åŠŸèƒ½
    function endGame() {
        clearInterval(gameState.timer);
        // ç¦ç”¨é‡åŠ›æ„Ÿåº”
        disableGameMotion();
         // é‡ç½®é‡åŠ›æ„Ÿåº”åŸºå‡†è§’åº¦
        resetBaselineAngle();
        const score = gameState.correctCount * 1;
        elements.finalScore.textContent = score;
        elements.finalCorrect.textContent = gameState.correctCount;
        elements.finalSkipped.textContent = gameState.skippedCount;

        let message = '';
        if (score >= 80) message = 'å¤ªå‰å®³äº†ï¼ä½ æ˜¯çŒœè¯å¤§å¸ˆï¼';
        else if (score >= 50) message = 'ä¸é”™å“¦ï¼ç»§ç»­åŠªåŠ›ï¼';
        else if (score >= 30) message = 'ç»§ç»­åŠ æ²¹ï¼Œä¸‹æ¬¡ä¼šæ›´å¥½ï¼';
        else message = 'å¤šç©å‡ æ¬¡ï¼Œç†Ÿèƒ½ç”Ÿå·§ï¼';

        elements.resultMessage.textContent = message;

        // åˆå§‹åŒ–å›é¡¾å†…å®¹
        initWordReview();

        // æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
        window.scrollTo({ top: 0, behavior: 'smooth' });

        showSection('result');
    }

    // ==================== æ–°å¢ï¼šè¯è¯­å›é¡¾åŠŸèƒ½ ====================

    function initWordReview() {
        // æ¸…ç©ºä¹‹å‰çš„å›é¡¾å†…å®¹
        elements.wordReviewList.innerHTML = '';

        // æ›´æ–°ç»Ÿè®¡æ•°å­—
        elements.reviewCorrectCount.textContent = gameState.correctCount;
        elements.reviewSkippedCount.textContent = gameState.skippedCount;

        // å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œæ˜¾ç¤ºæç¤º
        if (gameState.wordHistory.length === 0) {
            elements.wordReviewList.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: #666;">
                    <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px;"></i>
                    <p>æš‚æ— è¯è¯­å›é¡¾è®°å½•</p>
                </div>
            `;
            return;
        }

        // æ˜¾ç¤ºæ‰€æœ‰å†å²è¯è¯­
        gameState.wordHistory.forEach((item, index) => {
            const wordItem = document.createElement('div');
            wordItem.className = `word-item ${item.status}`;
            wordItem.innerHTML = `
                <div>${item.word}</div>
                <div class="word-status">${item.status === 'correct' ? 'âœ“' : 'â†’'}</div>
            `;
            elements.wordReviewList.appendChild(wordItem);
        });

        // ç›´æ¥æ“ä½œDOMï¼Œä¸ä¾èµ– toggleReview å‡½æ•°
        setTimeout(() => {
            elements.reviewContent.classList.add('expanded');
            elements.toggleReview.innerHTML = '<i class="fas fa-chevron-up"></i> æ”¶èµ·åˆ—è¡¨';
            elements.toggleReview.style.background = '#2575fc';
            elements.toggleReview.style.color = 'white';
        }, 10); // å¾®å°å»¶è¿Ÿç¡®ä¿DOMå·²æ›´æ–°
    }

    function toggleReview(forceExpand = false) {
        const isExpanded = elements.reviewContent.classList.contains('expanded') || forceExpand;

        if (!isExpanded) {
            elements.reviewContent.classList.add('expanded');
            elements.toggleReview.innerHTML = '<i class="fas fa-chevron-up"></i> æ”¶èµ·åˆ—è¡¨';
            elements.toggleReview.style.background = '#2575fc';
            elements.toggleReview.style.color = 'white';
        } else {
            elements.reviewContent.classList.remove('expanded');
            elements.toggleReview.innerHTML = '<i class="fas fa-chevron-down"></i> å±•å¼€æŸ¥çœ‹';
            elements.toggleReview.style.background = '#f0f7ff';
            elements.toggleReview.style.color = '#2575fc';
        }
    }

    function showReview() {
        // ç¡®ä¿å›é¡¾åŒºåŸŸå±•å¼€
        toggleReview(true);

        // æ»šåŠ¨åˆ°å›é¡¾åŒºåŸŸ
        elements.reviewContent.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        });
    }

    // ==================== æ‰‹åŠ¿æ£€æµ‹ç›¸å…³åŠŸèƒ½ ====================

    // 12. æ·»åŠ é‡ç½®åŸºå‡†è§’åº¦çš„åŠŸèƒ½
    function resetBaselineAngle() {
        console.log('é‡ç½®åŸºå‡†è§’åº¦');
        baselineAlpha = null;
    }

    // 13. åˆå§‹åŒ–æ—¶æä¾›æ ¡å‡†æç¤º

    // ä¿®æ”¹initGestureDetectionå‡½æ•°
    function initGestureDetection() {
        if (!window.DeviceOrientationEvent) {
            console.log('è®¾å¤‡ä¸æ”¯æŒæ–¹å‘ä¼ æ„Ÿå™¨');
            return;
        }

        if (!motionState.hasPermission) {
            console.log('é‡åŠ›æ„Ÿåº”æƒé™æœªæˆäºˆ');
            return;
        }

        startGestureListening();
    }


    function showCalibrationHint() {
        const hint = document.createElement('div');
        hint.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 5px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 9998;
            animation: fadeIn 0.3s ease;
        `;

        document.body.appendChild(hint);

        // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
        setTimeout(() => {
            hint.style.opacity = '0';
            hint.style.transition = 'opacity 0.3s ease';
            setTimeout(() => hint.remove(), 300);
        }, 3000);
    }

    // æ‰‹åŠ¿æ£€æµ‹å‡½æ•°
    // æ‰‹åŠ¿æ£€æµ‹å‡½æ•°
    function startGestureListening() {
        if (!window.DeviceOrientationEvent) {
            console.log('è®¾å¤‡ä¸æ”¯æŒæ–¹å‘ä¼ æ„Ÿå™¨');
            return;
        }

        if (!motionState.hasPermission) {
            console.log('é‡åŠ›æ„Ÿåº”æƒé™æœªæˆäºˆ');
            return;
        }

        // å¦‚æœå·²ç»æœ‰ç›‘å¬å™¨ï¼Œå…ˆç§»é™¤
        if (gameState.motionListener) {
            window.removeEventListener('deviceorientation', gameState.motionListener);
            gameState.motionListener = null;
        }

        let rotationHistory = [];
        let lastValidTime = 0;
        let baselineAlpha = null;
        let isCalibrated = false;
        let calibrationSamples = [];

        // ä¿å­˜ç›‘å¬å™¨å¼•ç”¨ï¼Œä»¥ä¾¿åç»­ç§»é™¤
        gameState.motionListener = (event) => {
            // æ£€æŸ¥é‡åŠ›æ„Ÿåº”æ˜¯å¦å¯ç”¨
            if (!gameState.motionEnabled) {
                return;
            }

            const currentTime = Date.now();
            const currentAlpha = event.alpha;

            // 1. æ ¡å‡†é˜¶æ®µ
            if (!isCalibrated) {
                calibrationSamples.push(currentAlpha);

                if (calibrationSamples.length >= 20) {
                    const sum = calibrationSamples.reduce((a, b) => a + b, 0);
                    baselineAlpha = sum / calibrationSamples.length;
                    isCalibrated = true;
                    console.log('æ ¡å‡†å®Œæˆï¼ŒåŸºå‡†è§’åº¦:', baselineAlpha);
                }
                return;
            }

            // 2. é˜²æŠ–å¤„ç†
            if (currentTime - lastValidTime < CONFIG.GESTURE.DEBUNCE_TIME) {
                return;
            }

            // 3. è®¡ç®—ç›¸å¯¹äºåŸºå‡†çš„è§’åº¦
            let relativeAngle = currentAlpha - baselineAlpha;
            if (relativeAngle > 180) relativeAngle -= 360;
            if (relativeAngle < -180) relativeAngle += 360;

            // 4. ä¿å­˜åˆ°å†å²è®°å½•
            rotationHistory.push({
                time: currentTime,
                angle: relativeAngle
            });

            if (rotationHistory.length > CONFIG.GESTURE.HISTORY_SIZE) {
                rotationHistory.shift();
            }

            // 5. æ£€æµ‹æ—‹è½¬æ‰‹åŠ¿
            if (rotationHistory.length >= 3) {
                detectSimpleRotation(rotationHistory);
            }
        };

        // æ·»åŠ äº‹ä»¶ç›‘å¬
        window.addEventListener('deviceorientation', gameState.motionListener);
        console.log('é‡åŠ›æ„Ÿåº”ç›‘å¬å·²å¯åŠ¨');
    }

    // å¯ç”¨æ¸¸æˆè¿‡ç¨‹ä¸­çš„é‡åŠ›æ„Ÿåº”
    function enableGameMotion() {
        gameState.motionEnabled = true;
        console.log('æ¸¸æˆé‡åŠ›æ„Ÿåº”å·²å¯ç”¨');
    }

    // ç¦ç”¨é‡åŠ›æ„Ÿåº”ï¼ˆæ¸¸æˆç»“æŸæˆ–æš‚åœæ—¶ï¼‰
    function disableGameMotion() {
        gameState.motionEnabled = false;
        console.log('æ¸¸æˆé‡åŠ›æ„Ÿåº”å·²ç¦ç”¨');
    }

    // å®Œå…¨åœæ­¢é‡åŠ›æ„Ÿåº”ç›‘å¬
    function stopGestureListening() {
        if (gameState.motionListener) {
            window.removeEventListener('deviceorientation', gameState.motionListener);
            gameState.motionListener = null;
            console.log('é‡åŠ›æ„Ÿåº”ç›‘å¬å·²åœæ­¢');
        }
        disableGameMotion();
    }

    // ç®€åŒ–çš„æ—‹è½¬æ£€æµ‹
    function detectSimpleRotation(history) {
         // æ£€æŸ¥é‡åŠ›æ„Ÿåº”æ˜¯å¦å¯ç”¨
        if (!gameState.motionEnabled) {
            return;
        }
        const now = Date.now();

        // å†·å´æ—¶é—´æ£€æŸ¥
        if (now - gameState.lastGestureTime < CONFIG.GESTURE.COOLDOWN) {
            return;
        }

        // å–æœ€è¿‘çš„æ•°æ®ç‚¹
        const recentPoints = history.slice(-4); // å–æœ€è¿‘4ä¸ªç‚¹

        // è®¡ç®—è§’åº¦å˜åŒ–
        const firstAngle = recentPoints[0].angle;
        const lastAngle = recentPoints[recentPoints.length - 1].angle;
        const timeDiff = recentPoints[recentPoints.length - 1].time - recentPoints[0].time;

        // è®¡ç®—æ€»è§’åº¦å˜åŒ–ï¼ˆè€ƒè™‘360åº¦è¾¹ç•Œï¼‰
        let totalAngleChange = lastAngle - firstAngle;
        if (totalAngleChange > 180) totalAngleChange -= 360;
        if (totalAngleChange < -180) totalAngleChange += 360;

        // è®¡ç®—æ—‹è½¬é€Ÿåº¦ï¼ˆåº¦/ç§’ï¼‰
        const rotationSpeed = timeDiff > 0 ? Math.abs(totalAngleChange) / (timeDiff / 1000) : 0;

        console.log(`è§’åº¦å˜åŒ–: ${totalAngleChange.toFixed(1)}Â°, é€Ÿåº¦: ${rotationSpeed.toFixed(1)}Â°/ç§’`);

        // æ£€æµ‹æ¡ä»¶
        const absAngleChange = Math.abs(totalAngleChange);

        // æ¡ä»¶1: è§’åº¦å˜åŒ–è¶³å¤Ÿå¤§
        const isAngleSufficient = absAngleChange >= CONFIG.GESTURE.MIN_ROTATION_ANGLE &&
                                absAngleChange <= CONFIG.GESTURE.MAX_ROTATION_ANGLE;

        // æ¡ä»¶2: æ—‹è½¬é€Ÿåº¦è¶³å¤Ÿå¿«
        const isSpeedSufficient = rotationSpeed >= CONFIG.GESTURE.ROTATION_SPEED_THRESHOLD;

        // æ¡ä»¶3: æ£€æŸ¥æ—‹è½¬æ–¹å‘æ˜¯å¦ä¸€è‡´
        const isDirectionConsistent = checkDirectionConsistency(recentPoints);

        if (isAngleSufficient && isSpeedSufficient && isDirectionConsistent) {
            // ç¡®å®šæ—‹è½¬æ–¹å‘
            if (totalAngleChange < 0) {
                // è´Ÿè§’åº¦å˜åŒ– = é¡ºæ—¶é’ˆæ—‹è½¬
                console.log(`æ£€æµ‹åˆ°é¡ºæ—¶é’ˆæ—‹è½¬: ${absAngleChange.toFixed(1)}Â°`);
                triggerGesture('clockwise');
                rotationHistory.length = 0; // æ¸…ç©ºå†å²ï¼Œé¿å…é‡å¤æ£€æµ‹
            } else if (totalAngleChange > 0) {
                // æ­£è§’åº¦å˜åŒ– = é€†æ—¶é’ˆæ—‹è½¬
                console.log(`æ£€æµ‹åˆ°é€†æ—¶é’ˆæ—‹è½¬: ${absAngleChange.toFixed(1)}Â°`);
                triggerGesture('counterclockwise');
                rotationHistory.length = 0; // æ¸…ç©ºå†å²
            }
        }
    }

    // æ£€æŸ¥æ–¹å‘ä¸€è‡´æ€§
    function checkDirectionConsistency(points) {
        if (points.length < 3) return true;

        let consistentCount = 0;
        for (let i = 1; i < points.length; i++) {
            const angleDiff = points[i].angle - points[i-1].angle;

            // æ£€æŸ¥ä¸»è¦æ–¹å‘
            if (Math.abs(angleDiff) > 2) { // å¿½ç•¥å¾®å°å˜åŒ–
                const firstSign = Math.sign(points[1].angle - points[0].angle);
                const currentSign = Math.sign(angleDiff);

                if (firstSign === currentSign) {
                    consistentCount++;
                }
            }
        }

        // è‡³å°‘70%çš„æ•°æ®ç‚¹æ–¹å‘ä¸€è‡´
        return consistentCount >= Math.floor((points.length - 1) * 0.7);
    }

    // è§¦å‘æ‰‹åŠ¿
    function triggerGesture(direction) {
        const now = Date.now();
        const cooldown = gameState.lastGestureTime ? CONFIG.GESTURE.COOLDOWN : 0;

        if (now - gameState.lastGestureTime < cooldown) {
            console.log('æ‰‹åŠ¿å†·å´ä¸­...');
            return;
        }

        gameState.lastGestureTime = now;

        // æä¾›å³æ—¶è§†è§‰åé¦ˆ
        const feedback = document.createElement('div');
        feedback.className = 'instant-feedback';
        feedback.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            z-index: 9999;
            pointer-events: none;
            animation: popIn 0.3s ease-out;
        `;

        if (direction === 'clockwise') {
            feedback.textContent = 'âœ…';
            feedback.style.color = '#2ed573';
            console.log('è§¦å‘ï¼šé¡ºæ—¶é’ˆæ—‹è½¬ - çŒœå¯¹');
            setTimeout(() => markCorrect(), 50); // å»¶è¿Ÿ50msæ‰§è¡Œï¼Œè®©ç”¨æˆ·çœ‹åˆ°åé¦ˆ
        } else {
            feedback.textContent = 'â­ï¸';
            feedback.style.color = '#ff9f43';
            console.log('è§¦å‘ï¼šé€†æ—¶é’ˆæ—‹è½¬ - è·³è¿‡');
            setTimeout(() => skipWord(), 50);
        }

        document.body.appendChild(feedback);

        setTimeout(() => {
            feedback.style.opacity = '0';
            feedback.style.transition = 'opacity 0.2s ease';
            setTimeout(() => feedback.remove(), 200);
        }, 300);
    }

    // ==================== å·¥å…·å‡½æ•° ====================
    function showSection(section) {
        // æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
        if (section !== 'theme') {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        document.querySelectorAll('.game-section').forEach(el => {
            el.classList.remove('active-section');
        });

        const target = document.getElementById(section + 'Section');
        if (target) target.classList.add('active-section');

        // å½“ç¦»å¼€æ¸¸æˆç•Œé¢æ—¶ï¼Œç¦ç”¨é‡åŠ›æ„Ÿåº”
        if (section !== 'game') {
            disableGameMotion();
        }
    }

    function showLoader(show) {
        elements.loader.style.display = show ? 'block' : 'none';
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // é»˜è®¤è¯è¯­æ•°æ®ï¼ˆå¤‡ç”¨ï¼‰
    function getDefaultWords(filename) {
        const defaults = {
            'idiom.txt': [],
            'star.txt': [],
            'food.txt': [],
            'sport.txt': [],
            'movie.txt': [],
            'animal.txt': []
        };
        return defaults[filename] || [];
    }

    function getDefaultThemes() {
        return [
            {
                id: 'idiom',
                name: 'æˆè¯­',
                icon: 'fas fa-book-open',
                color: '#2575fc',
                words: getDefaultWords('idiom.txt')
            },
            {
                id: 'star',
                name: 'æ˜æ˜Ÿ',
                icon: 'fas fa-star',
                color: '#ff9f43',
                words: getDefaultWords('star.txt')
            }
        ];
    }

    // ==================== äº‹ä»¶ç›‘å¬ ====================
    
    document.getElementById('startGameBtn').addEventListener('click', startGame);
    elements.startNowBtn.addEventListener('click', startGameNow);
    elements.cancelStartBtn.addEventListener('click', () => showSection('theme'));

    document.getElementById('correctBtn').addEventListener('click', markCorrect);
    document.getElementById('skipBtn').addEventListener('click', skipWord);
    document.getElementById('endGameBtn').addEventListener('click', endGame);

    document.getElementById('playAgainBtn').addEventListener('click', () =>    {
        disableGameMotion(); // æ–°å¢ï¼šç¦ç”¨é‡åŠ›æ„Ÿåº”
        showSection('theme')
    });
    document.getElementById('backToThemeBtn').addEventListener('click', () => {
        disableGameMotion(); // æ–°å¢ï¼šç¦ç”¨é‡åŠ›æ„Ÿåº”
        showSection('theme');
    });    
    // åœ¨ç°æœ‰çš„äº‹ä»¶ç›‘å¬éƒ¨åˆ†æ·»åŠ 
    document.getElementById('requestMotionBtn').addEventListener('click', requestMotionPermission);

    // æ–°å¢ï¼šå›é¡¾ç›¸å…³äº‹ä»¶
    elements.toggleReview.addEventListener('click', () => toggleReview());
    // elements.showReviewBtn.addEventListener('click', showReview);

    // ==================== åˆå§‹åŒ– ====================
    // ä¿®æ”¹åˆå§‹åŒ–å‡½æ•°
    window.addEventListener('DOMContentLoaded', () => {
        initAllThemes();

        // æ£€æŸ¥è®¾å¤‡æ”¯æŒæƒ…å†µå¹¶æ›´æ–°UI
        if (!motionState.isSupported) {
            const requestBtn = document.getElementById('requestMotionBtn');
            requestBtn.disabled = true;
            requestBtn.innerHTML = '<i class="fas fa-ban"></i> è®¾å¤‡ä¸æ”¯æŒ';
            requestBtn.style.opacity = '0.6';
        }

        // æ·»åŠ CSSåŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.7; }
            }
        `;
        document.head.appendChild(style);
    });
    // ==================== æ–°å¢ï¼šåé¦ˆåŠŸèƒ½äº‹ä»¶ç›‘å¬ ====================
        document.getElementById('feedbackTrigger').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('feedbackModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        });

        document.querySelector('.close-modal').addEventListener('click', function() {
            document.getElementById('feedbackModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        });

        document.getElementById('feedbackModal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });

        document.getElementById('sendEmailBtn').addEventListener('click', function() {
            const message = document.getElementById('userMessage').value.trim();
            
            if (!message) {
                alert('è¯·è¾“å…¥æ‚¨çš„ç•™è¨€å†…å®¹');
                document.getElementById('userMessage').focus();
                return;
            }
            
            // è·å–ç”¨æˆ·è®¾å¤‡ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
            const deviceInfo = `è®¾å¤‡ä¿¡æ¯: ${navigator.userAgent}`;
            const gameVersion = `æ¸¸æˆç‰ˆæœ¬: 1.0`;
            
            // æ„é€ é‚®ä»¶å†…å®¹
            const subject = encodeURIComponent('ã€ä½ è¯´æˆ‘çŒœæ¸¸æˆã€‘ç”¨æˆ·åé¦ˆ');
            const body = encodeURIComponent(`ç”¨æˆ·åé¦ˆå†…å®¹ï¼š\n\n${message}\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n${gameVersion}\n${deviceInfo}\n\næ„Ÿè°¢æ‚¨çš„åé¦ˆï¼`);
            
            // æ‰“å¼€é‚®ä»¶å®¢æˆ·ç«¯
            window.location.href = `mailto:ming95ming@126.com?subject=${subject}&body=${body}`;
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('userMessage').value = '';
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            const sendBtn = this;
            const originalText = sendBtn.innerHTML;
            sendBtn.innerHTML = '<i class="fas fa-check"></i> é‚®ä»¶å®¢æˆ·ç«¯å·²æ‰“å¼€';
            sendBtn.style.background = '#2ed573';
            
            // å»¶è¿Ÿä¸€ç‚¹æ—¶é—´ï¼Œè®©ç”¨æˆ·çœ‹åˆ°æŒ‰é’®çŠ¶æ€å˜åŒ–
            setTimeout(() => {
                window.location.href = `mailto:ming95ming@126.com?subject=${subject}&body=${body}`;
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                setTimeout(() => {
                    sendBtn.innerHTML = originalText;
                    sendBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                }, 1000);
                
            }, 300);
        });

        // å½“å¼¹çª—æ‰“å¼€æ—¶è‡ªåŠ¨èšç„¦åˆ°è¾“å…¥æ¡†
        document.getElementById('feedbackModal').addEventListener('click', function(e) {
            if (e.target === this || e.target.classList.contains('close-modal')) {
                return;
            }
            setTimeout(() => {
                document.getElementById('userMessage').focus();
            }, 300);
        });

        // ç¡®ä¿é¡µé¢å†…å®¹ä¸ä¼šè¢«åº•éƒ¨æ é®æŒ¡
        function adjustContentPadding() {
            const footerHeight = document.getElementById('globalFooter').offsetHeight;
            document.body.style.paddingBottom = footerHeight + 20 + 'px';
        }

        // é¡µé¢åŠ è½½å®Œæˆåè°ƒæ•´å†…è¾¹è·
        window.addEventListener('load', adjustContentPadding);
        window.addEventListener('resize', adjustContentPadding);

        // é˜»æ­¢åœ¨åé¦ˆå¼¹çª—å†…æ»šåŠ¨æ—¶èƒŒæ™¯æ»šåŠ¨
        document.getElementById('feedbackModal').addEventListener('touchmove', function(e) {
            if (e.target === this) {
                e.preventDefault();
            }
        }, { passive: false });
</script>
    
</body>
</html>