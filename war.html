<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>窃听风云</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            background-color: #0a0a14;
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* 首页样式 */
        #homePage {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
        }

        .background-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(rgba(10, 10, 20, 0.8), rgba(10, 10, 20, 0.9)),
                url('https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');
            background-size: cover;
            background-position: center;
            filter: brightness(0.7) contrast(1.2);
            z-index: -1;
        }

        .title {
            font-size: 3.5rem;
            font-weight: bold;
            color: #00b894;
            text-shadow: 0 0 10px rgba(0, 184, 148, 0.5),
                         0 0 20px rgba(0, 184, 148, 0.3);
            margin-bottom: 50px;
            text-align: center;
            letter-spacing: 4px;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                text-shadow: 0 0 10px rgba(0, 184, 148, 0.5),
                             0 0 20px rgba(0, 184, 148, 0.3);
            }
            to {
                text-shadow: 0 0 15px rgba(0, 184, 148, 0.7),
                             0 0 25px rgba(0, 184, 148, 0.5),
                             0 0 35px rgba(0, 184, 148, 0.3);
            }
        }

        .subtitle {
            font-size: 1.2rem;
            color: #81ecec;
            margin-bottom: 80px;
            text-align: center;
            font-weight: 300;
            letter-spacing: 2px;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 25px;
            width: 100%;
            max-width: 320px;
        }

        .menu-btn {
            background: linear-gradient(135deg, #006266 0%, #00a8a8 100%);
            border: none;
            border-radius: 15px;
            padding: 20px 30px;
            font-size: 1.4rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 5px 15px rgba(0, 168, 168, 0.3);
            letter-spacing: 1px;
        }

        .menu-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 168, 168, 0.4);
        }

        .menu-btn:active {
            transform: translateY(-1px);
        }

        .menu-btn i {
            font-size: 1.6rem;
        }

        /* 密码本页面样式 - 竖屏模式 */
        #codebookPage {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
            padding: 20px;
            overflow-y: auto;
        }

        .page-title {
            font-size: 2rem;
            color: #00b894;
            text-align: center;
            margin-bottom: 25px;
            text-shadow: 0 0 5px rgba(0, 184, 148, 0.5);
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

       .card {
    background: linear-gradient(135deg, #2d3436 0%, #34495e 100%);
    border-radius: 15px;
    padding: 15px; /* 增加内边距 */
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
    border: 5px solid #00b894;
    position: relative;
    height: 100px; /* 增加高度，从80px增加到100px */
    min-height: 100px; /* 调整最小高度 */
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
}

        /* 修改卡片编号样式 */
        .card-number {
            width: 30px;
            height: 30px;
            background: #00b894;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            box-shadow: 0 3px 8px rgba(0, 184, 148, 0.3);
            flex-shrink: 0;
        }

        /* 卡片内容区域 */
        .card-content {
            display: flex;
            align-items: center;
            flex: 1;
            justify-content: center;
            gap: 10px;
            padding: 0;
        }

/* 修改卡片内的词语样式 - 加大并加粗 */
.card-word {
    font-size: 2.0rem; /* 从1.4rem增加到2.0rem */
    font-weight: 800;   /* 增加加粗程度，从bold改为800 */
    color: #dfe6e9;
    text-align: center;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7); /* 增强阴影效果 */
    display: flex;
    align-items: center;
    justify-content: center;
    flex: 1;
    word-break: break-word;
    line-height: 1.3;
    padding: 0;
}

        /* 切换按钮样式 */
        .change-word-btn {
            background: #0984e3;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            color: white;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .change-word-btn:hover {
            background: #74b9ff;
            transform: translateY(-2px);
        }

        /* 修改统计区域布局 - 保持在一行 */
.stats-section-container {
    display: flex;
    flex-direction: row; /* 确保横向排列 */
    justify-content: space-between; /* 左右分布 */
    max-width: 500px;
    margin: 30px auto 0;
    gap: 20px;
    flex-wrap: nowrap; /* 防止换行 */
}

/* 添加我方失败次数的红色样式 */
.stat-item.failure-item .stat-title {
    color: #ffcccc; /* 浅红色文字 */
}

.stat-item.failure-item .stat-value {
    color: #ff6666; /* 亮红色数值 */
}

.stat-item.failure-item .stat-btn {
    background: #c0392b; /* 深红色按钮 */
}

.stat-item.failure-item .stat-btn:hover {
    background: #e74c3c; /* 悬停时亮红色 */
}
/* 敌方行动中的失败次数特殊样式 - 绿色 */
.stats-section.enemy-action .stat-item.failure-item .stat-title {
    color: #00b894 !important; /* 浅绿色文字 */
}

.stats-section.enemy-action .stat-item.failure-item .stat-value {
    color: #00b894 !important; /* 次数数字亮绿色数值 */
}

.stats-section.enemy-action .stat-item.failure-item .stat-btn {
    background: #00b894 !important; /* 青绿色按钮 */
}

.stats-section.enemy-action .stat-item.failure-item .stat-btn:hover {
    background: #00b894 !important; /* 悬停时亮绿色 */
}
  .stats-section {
    flex: 1;
    background: rgba(45, 52, 54, 0.7);
    padding: 20px;
    border-radius: 12px;
    border: 1px solid;
    min-width: 150px;
}


.stats-section.our-action {
    border-color: #00b894;
    /* 移除之前多余的 margin-right: auto; */
}

.stats-section.enemy-action {
    border-color: #e74c3c;
    /* 移除之前多余的 margin-left: auto; */
}
/* 敌方区域使用我方颜色主题的项 */
.stats-section.enemy-action .stat-item.our-theme-item .stat-title {
    color: #00b894 !important; /* 保持原有的文字颜色 */
}

.stats-section.enemy-action .stat-item.our-theme-item .stat-value {
    color: #00b894 !important; /* 青色数值，匹配我方主题 */
}

.stats-section.enemy-action .stat-item.our-theme-item .stat-btn {
    background: #00b894 !important; /* 蓝色按钮，匹配我方主题 */
}

.stats-section.enemy-action .stat-item.our-theme-item .stat-btn:hover {
    background: #00b894 !important; /* 悬停时浅蓝色 */
}

/* 修改我方行动中的破译敌方密码次数为#00b894颜色 */
.stats-section.our-action .stat-item:not(.failure-item) .stat-title {
    color: #00b894 !important; /* 文字颜色改为#00b894 */
}

.stats-section.our-action .stat-item:not(.failure-item) .stat-value {
    color: #00b894 !important; /* 数值颜色改为#00b894 */
}

.stats-section.our-action .stat-item:not(.failure-item) .stat-btn {
    background: #00b894 !important; /* 按钮背景改为#00b894 */
}

.stats-section.our-action .stat-item:not(.failure-item) .stat-btn:hover {
    background: #00a884 !important; /* 悬停时稍深一点的#00b894 */
}

/* 修改敌方行动中的破译我方密码次数为#e74c3c颜色 */
.stats-section.enemy-action .stat-item:not(.failure-item) .stat-title {
    color: #e74c3c !important; /* 文字颜色改为#e74c3c */
}

.stats-section.enemy-action .stat-item:not(.failure-item) .stat-value {
    color: #e74c3c !important; /* 数值颜色改为#e74c3c */
}

.stats-section.enemy-action .stat-item:not(.failure-item) .stat-btn {
    background: #e74c3c !important; /* 按钮背景改为#e74c3c */
}

.stats-section.enemy-action .stat-item:not(.failure-item) .stat-btn:hover {
    background: #c0392b !important; /* 悬停时稍深一点的红色 */
}
/* 修改我方行动中的失败项为#e74c3c颜色 */
.stats-section.our-action .stat-item.failure-item .stat-title {
    color: #e74c3c !important; /* 文字颜色改为#e74c3c */
}

.stats-section.our-action .stat-item.failure-item .stat-value {
    color: #e74c3c !important; /* 数值颜色改为#e74c3c */
}

.stats-section.our-action .stat-item.failure-item .stat-btn {
    background: #e74c3c !important; /* 按钮背景改为#e74c3c */
}

.stats-section.our-action .stat-item.failure-item .stat-btn:hover {
    background: #c0392b !important; /* 悬停时稍深一点的红色 */
}
/* 特别处理失败项中的数字颜色 */
.stats-section.enemy-action .stat-item.failure-item.our-theme-item .stat-value {
    color: #00b894 !important; /* 绿色数值，匹配失败项主题 */
}
        .section-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #fff;
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid;
        }

        .section-title.our-title {
            border-color: #00b894;
            color: #00b894;
        }

        .section-title.enemy-title {
            border-color: #e74c3c;
            color: #e74c3c;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .stat-title {
            font-size: 0.95rem;
            color: #dfe6e9;
            font-weight: 500;
        }

        .stat-control {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }

        .stat-value.our-value {
            color: #00b894;
        }

        .stat-value.enemy-value {
            color: #e74c3c;
        }

        .stat-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-btn.our-btn {
            background: #0984e3;
        }

        .stat-btn.enemy-btn {
            background: #c0392b;
        }

        .stat-btn:hover {
            opacity: 0.9;
            transform: scale(1.1);
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 184, 148, 0.8);
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
        }

        .back-btn:hover {
            background: rgba(0, 184, 148, 1);
            transform: translateY(-2px);
        }

        /* 电报机页面样式 */
        #telegraphPage {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(rgba(10, 10, 20, 0.9), rgba(10, 10, 20, 0.95)),
                url('https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');
            background-size: cover;
            background-position: center;
            padding: 20px;
            overflow-y: auto;
        }

        .telegraph-container {
            max-width: 500px;
            margin: 50px auto 0;
            padding: 30px;
            background: rgba(26, 26, 46, 0.8);
            border-radius: 20px;
            border: 3px solid #00b894;
            box-shadow: 0 0 30px rgba(0, 184, 148, 0.3);
            position: relative;
        }

        .telegraph-screen {
            background: #0c0c1a;
            border: 2px solid #00b894;
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 40px;
            text-align: center;
            box-shadow: inset 0 0 20px rgba(0, 184, 148, 0.2);
        }

        .telegraph-number {
            font-size: 4.5rem;
            font-weight: bold;
            color: #00ff9d;
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
            letter-spacing: 10px;
            font-family: 'Courier New', monospace;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
            }
            50% {
                opacity: 0.9;
                text-shadow: 0 0 15px rgba(0, 255, 157, 0.7),
                             0 0 25px rgba(0, 255, 157, 0.3);
            }
        }

        .telegraph-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .telegraph-btn {
            background: linear-gradient(135deg, #006266 0%, #00a8a8 100%);
            border: none;
            border-radius: 15px;
            padding: 20px 40px;
            font-size: 1.6rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 5px 15px rgba(0, 168, 168, 0.3);
        }

        .telegraph-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 168, 168, 0.4);
        }

        .telegraph-btn:active {
            transform: translateY(-1px);
        }

        /* 确认弹窗 */
        .confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .confirm-content {
            background: #1a1a2e;
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            border: 2px solid #00b894;
            box-shadow: 0 0 30px rgba(0, 184, 148, 0.3);
        }

        .confirm-text {
            font-size: 1.4rem;
            color: #dfe6e9;
            text-align: center;
            margin-bottom: 30px;
        }

        .confirm-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .confirm-btn {
            padding: 15px 30px;
            border-radius: 10px;
            border: none;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .confirm-yes {
            background: #00b894;
            color: white;
        }

        .confirm-no {
            background: #636e72;
            color: white;
        }

        .confirm-btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .title {
                font-size: 2.8rem;
            }

            .cards-container {
                grid-template-columns: 1fr;
                gap: 12px;
                max-width: 400px;
            }

            .card {
                min-height: 50px;
                padding: 10px;
                gap: 8px;
            }

            .card-number {
                width: 25px;
                height: 25px;
                font-size: 1rem;
            }

            .card-word {
                font-size: 1.2rem;
            }

            .change-word-btn {
                padding: 5px 10px;
                font-size: 0.75rem;
            }

            .card-content {
                gap: 8px;
            }

            .telegraph-number {
                font-size: 3.5rem;
                letter-spacing: 8px;
            }

            .page-title {
                font-size: 1.8rem;
                margin-bottom: 20px;
            }

<!--            .stats-section-container {-->
<!--                flex-direction: column;-->
<!--                gap: 15px;-->
<!--            }-->

            .stats-section {
                width: 100%;
                min-width: unset;
            }

            .stats-section.our-action {
                margin-right: 0;
            }

            .stats-section.enemy-action {
                margin-left: 0;
            }
        }

        @media (max-width: 480px) {
            .title {
                font-size: 2.2rem;
            }

            .menu-btn {
                font-size: 1.2rem;
                padding: 18px 25px;
            }

            .card {
                min-height: 45px;
                padding: 8px;
                gap: 6px;
            }

            .card-word {
                font-size: 1.1rem;
            }

            .change-word-btn {
                padding: 4px 8px;
                font-size: 0.7rem;
            }

            .card-number {
                width: 22px;
                height: 22px;
                font-size: 0.9rem;
            }

            .card-content {
                gap: 6px;
            }

            .telegraph-number {
                font-size: 2.8rem;
                letter-spacing: 6px;
            }

            .stats-section-container {
                gap: 12px;
            }

            .stats-section {
                padding: 15px;
            }

            .section-title {
                font-size: 1.1rem;
            }

            .stat-value {
                font-size: 1.3rem;
            }

            .stat-btn {
                width: 32px;
                height: 32px;
                font-size: 1.1rem;
            }
        }

        /* 加载动画 */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 20, 0.9);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(0, 184, 148, 0.3);
            border-top: 5px solid #00b894;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
<!-- 首页 -->
<div id="homePage">
    <div class="background-overlay"></div>
    <h1 class="title">窃听风云</h1>
    <p class="subtitle">机密通信 · 密码破译 · 电报传递</p>
    <div class="menu-buttons">
        <button class="menu-btn" id="codebookBtn">
            <i class="fas fa-book"></i> 密码本
        </button>
        <button class="menu-btn" id="telegraphBtn">
            <i class="fas fa-broadcast-tower"></i> 电报机
        </button>
    </div>
</div>

<!-- 密码本页面 -->
<div id="codebookPage">
    <button class="back-btn" id="backFromCodebook">
        <i class="fas fa-arrow-left"></i>
    </button>
    <h2 class="page-title">密码本</h2>

    <div class="cards-container" id="cardsContainer">
        <!-- 卡片将通过JS动态生成 -->
    </div>

    <!-- 修改后的统计区域 -->
    <div class="stats-section-container">
        <!-- 我方行动 - 靠左下 -->
        <div class="stats-section our-action">
            <div class="section-title our-title">我方行动</div>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-title">破译敌方密码次数</div>
                    <div class="stat-control">
                        <button class="stat-btn our-btn" onclick="changeStat('crackEnemy', -1, 'our')">-</button>
                        <span class="stat-value our-value" id="crackEnemy">0</span>
                        <button class="stat-btn our-btn" onclick="changeStat('crackEnemy', 1, 'our')">+</button>
                    </div>
                </div>

                <div class="stat-item failure-item">
                    <div class="stat-title">密文传递失败次数</div>
                    <div class="stat-control">
                        <button class="stat-btn our-btn" onclick="changeStat('transmitFail', -1, 'our')">-</button>
                        <span class="stat-value our-value" id="transmitFail">0</span>
                        <button class="stat-btn our-btn" onclick="changeStat('transmitFail', 1, 'our')">+</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 敌方行动 - 靠右下 -->
        <div class="stats-section enemy-action">
            <div class="section-title enemy-title">敌方行动</div>
            <div class="stats-grid">
                <div class="stat-item ">
                    <div class="stat-title">破译我方密码次数</div>
                    <div class="stat-control">
                        <button class="stat-btn enemy-btn" onclick="changeStat('enemyCrack', -1, 'enemy')">-</button>
                        <span class="stat-value enemy-value" id="enemyCrack">0</span>
                        <button class="stat-btn enemy-btn" onclick="changeStat('enemyCrack', 1, 'enemy')">+</button>
                    </div>
                </div>

                <div class="stat-item failure-item our-theme-item">
                    <div class="stat-title">密文传递失败次数</div>
                    <div class="stat-control">
                        <button class="stat-btn enemy-btn" onclick="changeStat('enemyTransmitFail', -1, 'enemy')">-</button>
                        <span class="stat-value enemy-value" id="enemyTransmitFail">0</span>
                        <button class="stat-btn enemy-btn" onclick="changeStat('enemyTransmitFail', 1, 'enemy')">+</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 电报机页面 -->
<div id="telegraphPage">
    <button class="back-btn" id="backFromTelegraph">
        <i class="fas fa-arrow-left"></i>
    </button>
    <div class="telegraph-container">
        <div class="telegraph-screen">
            <div class="telegraph-number" id="telegraphCode">1.3.2</div>
        </div>
        <div class="telegraph-controls">
            <button class="telegraph-btn" id="changeCodeBtn">
                <i class="fas fa-random"></i>
            </button>
        </div>
    </div>
</div>

<!-- 确认弹窗 -->
<div class="confirm-modal" id="confirmModal">
    <div class="confirm-content">
        <p class="confirm-text" id="confirmText">确定要更换电报码吗？</p>
        <div class="confirm-buttons">
            <button class="confirm-btn confirm-yes" id="confirmYes">确定</button>
            <button class="confirm-btn confirm-no" id="confirmNo">取消</button>
        </div>
    </div>
</div>

<!-- 加载动画 -->
<div class="loading" id="loading">
    <div class="spinner"></div>
    <p style="color: #00b894; font-size: 1.2rem;">加载中...</p>
</div>

<script>
    // 游戏状态
    const gameState = {
        words: [],
        currentWords: ['', '', '', ''],
        stats: {
            crackEnemy: 0,
            transmitFail: 0,
            enemyCrack: 0,
            enemyTransmitFail: 0
        },
        telegraphCode: '1.3.2'
    };

    // DOM元素
    const elements = {
        homePage: document.getElementById('homePage'),
        codebookPage: document.getElementById('codebookPage'),
        telegraphPage: document.getElementById('telegraphPage'),
        cardsContainer: document.getElementById('cardsContainer'),
        telegraphCode: document.getElementById('telegraphCode'),
        confirmModal: document.getElementById('confirmModal'),
        confirmText: document.getElementById('confirmText'),
        confirmYes: document.getElementById('confirmYes'),
        confirmNo: document.getElementById('confirmNo'),
        loading: document.getElementById('loading')
    };

    // 页面切换
    function showPage(page) {
        elements.homePage.style.display = 'none';
        elements.codebookPage.style.display = 'none';
        elements.telegraphPage.style.display = 'none';

        if (page === 'home') {
            elements.homePage.style.display = 'flex';
        } else if (page === 'codebook') {
            elements.codebookPage.style.display = 'block';
            initCodebook();
        } else if (page === 'telegraph') {
            elements.telegraphPage.style.display = 'block';
            updateTelegraphCode();
        }

        // 重置滚动位置
        window.scrollTo(0, 0);
    }

    // 加载词语文件
    async function loadWords() {
        showLoading(true);
        try {
            // 尝试从不同路径加载
            const paths = [
                'words.txt',
                './words.txt',
                'word.txt',
                './word.txt',
                'words/words.txt',
                'words/word.txt'
            ];

            let response;
            for (const path of paths) {
                try {
                    response = await fetch(path);
                    if (response.ok) break;
                } catch (e) {
                    continue;
                }
            }

            if (!response || !response.ok) {
                throw new Error('无法加载词语文件');
            }

            const text = await response.text();
            const words = text.split('\n')
                .map(word => word.trim())
                .filter(word => word.length > 0 && !word.startsWith('#'));

            if (words.length === 0) {
                // 如果文件为空，使用默认词语
                gameState.words = getDefaultWords();
            } else {
                gameState.words = words;
            }

            console.log(`加载了 ${gameState.words.length} 个词语`);
            return true;
        } catch (error) {
            console.error('加载词语失败:', error);
            gameState.words = getDefaultWords();
            return true;
        } finally {
            showLoading(false);
        }
    }

    // 默认词语（备用）
    function getDefaultWords() {
        return [
            '情报', '密码', '电台', '间谍', '监听', '解密', '加密', '电报',
            '暗号', '代号', '行动', '任务', '目标', '地点', '时间', '人员',
            '文件', '资料', '证据', '线索', '嫌疑', '追踪', '监视', '卧底',
            '接头', '信号', '频率', '波长', '干扰', '扫描', '分析', '破译',
            '通讯', '网络', '系统', '程序', '代码', '密钥', '算法', '协议',
            '安全', '机密', '绝密', '公开', '秘密', '内部', '外部', '边界',
            '防御', '攻击', '保护', '破坏', '渗透', '反制', '对抗', '竞争'
        ];
    }

    // 获取随机词语
    function getRandomWord() {
        if (gameState.words.length === 0) {
            return '未加载';
        }
        const randomIndex = Math.floor(Math.random() * gameState.words.length);
        return gameState.words[randomIndex];
    }

    // 初始化密码本
    function initCodebook() {
        // 确保有4个词语
        for (let i = 0; i < 4; i++) {
            if (!gameState.currentWords[i]) {
                gameState.currentWords[i] = getRandomWord();
            }
        }

        // 渲染卡片
        renderCards();

        // 加载统计数据
        loadStats();
    }

    // 渲染卡片
    function renderCards() {
        elements.cardsContainer.innerHTML = '';

        for (let i = 0; i < 4; i++) {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="card-number">${i + 1}</div>
                <div class="card-content">
                    <div class="card-word">${gameState.currentWords[i]}</div>
                    <button class="change-word-btn" onclick="changeWord(${i})">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            `;
            elements.cardsContainer.appendChild(card);
        }
    }

    // 更换单个词语
    function changeWord(index) {
        gameState.currentWords[index] = getRandomWord();
        renderCards();
    }

    // 更新统计数字
    function changeStat(stat, delta, type) {
        let newValue = gameState.stats[stat] + delta;
        if (newValue < 0) newValue = 0;
        gameState.stats[stat] = newValue;
        document.getElementById(stat).textContent = newValue;
        saveStats();
    }

    // 保存统计数据
    function saveStats() {
        localStorage.setItem('telegraph_stats', JSON.stringify(gameState.stats));
    }

    // 加载统计数据
    function loadStats() {
        const saved = localStorage.getItem('telegraph_stats');
        if (saved) {
            try {
                gameState.stats = JSON.parse(saved);
                // 更新UI
                Object.keys(gameState.stats).forEach(stat => {
                    const element = document.getElementById(stat);
                    if (element) {
                        element.textContent = gameState.stats[stat];
                    }
                });
            } catch (e) {
                console.error('加载统计失败:', e);
            }
        }
    }

    // 生成电报码
    function generateTelegraphCode() {
        const numbers = [1, 2, 3, 4];
        // 随机打乱数组并取前3个
        const shuffled = [...numbers].sort(() => Math.random() - 0.5);
        return shuffled.slice(0, 3).join('.');
    }

    // 更新电报码
    function updateTelegraphCode() {
        gameState.telegraphCode = generateTelegraphCode();
        elements.telegraphCode.textContent = gameState.telegraphCode;
    }

    // 确认更换电报码
    function confirmChangeTelegraphCode() {
        elements.confirmText.textContent = '确定要更换电报码吗？';
        elements.confirmModal.style.display = 'flex';
    }

    // 显示/隐藏加载动画
    function showLoading(show) {
        elements.loading.style.display = show ? 'flex' : 'none';
    }

    // 事件监听
    document.getElementById('codebookBtn').addEventListener('click', async () => {
        await loadWords();
        showPage('codebook');
    });

    document.getElementById('telegraphBtn').addEventListener('click', () => {
        showPage('telegraph');
    });

    document.getElementById('backFromCodebook').addEventListener('click', () => {
        showPage('home');
    });

    document.getElementById('backFromTelegraph').addEventListener('click', () => {
        showPage('home');
    });

    document.getElementById('changeCodeBtn').addEventListener('click', () => {
        confirmChangeTelegraphCode();
    });

    elements.confirmYes.addEventListener('click', () => {
        updateTelegraphCode();
        elements.confirmModal.style.display = 'none';
    });

    elements.confirmNo.addEventListener('click', () => {
        elements.confirmModal.style.display = 'none';
    });

    // 点击蒙版关闭确认框
    elements.confirmModal.addEventListener('click', (e) => {
        if (e.target === elements.confirmModal) {
            elements.confirmModal.style.display = 'none';
        }
    });

    // 初始加载
    document.addEventListener('DOMContentLoaded', async () => {
        // 预加载词语
        await loadWords();

        // 确保初始电报码
        updateTelegraphCode();

        // 添加键盘快捷键
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (elements.codebookPage.style.display === 'block' ||
                    elements.telegraphPage.style.display === 'block') {
                    showPage('home');
                }
            }
        });
    });
</script>
</body>
</html>